<% content_for :title, @property.address1 %>

    <!-- Big address title that zooms in at top upon page load -->
    <div id="ps-addr-title-zoom-container">
      <h3 id="ps-addr-title-zoom">
        <span id="ps-addr-title-zoom__text">
        <%= @property.address1 %></span>
      </h3>
    </div>
    
    <% if current_user && current_user.admin? && logged_in? %>
      <div id="ps-edit-link">
        <%= link_to "Edit", property_edit_path(@property) %>
      </div>
    <% end %>
    
    <div id="ps-photo-main-container">
      <% if (photo = @property.photos.first) && photo.filename %>
        <%= image_tag("http://altadenaheritagepdb.org/photo/" + 
              photo.filename, 
              :id => "ps-photo-main", :alt => "Photo of Property") %>
      <% else %>
        <div id='ps-photo-main-no-photo'>
          <%= image_tag('house-stick-figure-med.png',
                    :alt => 'Cartoon Photo of Property') %>
          <br>
          We do not have a picture of this house yet.  
          <a href="http://altadenaheritage.org/contact-us/" target="_blank">
          Let us know</a> if you have one!
        </div>
      <% end %>

    </div>
    
    <div id="ps-addr-title-fader"><%= @property.address1 %></div>
    

    <!-- JS onClickEvent added to #ps-dl-pdf-img to pop up wait spinner -->    
    <div id="ps-dl-pdf-img">
    <%= link_to image_tag('pdf-dl-button-65x24.png', :alt => 'Download PDF'), 
        property_path(@property.id) + ".pdf" %>
    </div>

    <div id="ps-pdf-please-wait-container">
      <div id="ps-pdf-please-wait">
        <%= image_tag('ring-alt.svg', :alt => 'Please Wait...') %>
        <br>
        <b>Generating PDF file...</b>
      </div>
    </div>



    <!-- All fields listed below -->
    <div class="ps-db-details">

      <%= ps_markup("APN", (apn = @property.apn) && apn.parcel) %>
      <%= ps_markup("Year Built", @property.yearbuilt_qualified) %>
      <%= ps_markup("Year Built (Assessor)", @property.yearbuiltassessor) %>
      <%= ps_markup("Year Built (Other)", @property.yearbuiltother) %>
      <%= ps_markup("Legal Description", @property.legaldescription) %>
      <%= ps_markup("Quadrant", @property.quadrant, true) %>
      <%= ps_markup("Current Lot Size", @property.currentlotsize) %>
      <%= ps_markup("Historic Name", @property.historicname) %>
      <%= ps_markup("Style", @property.style) %>
      <%= ps_markup("Stories", @property.stories) %>
      <%= ps_markup("Type", 
          @property.type != nil ? @property.type.capitalize : "", true) %>
      <%= ps_markup("CHRS", @property.chrs) %>

      <!-- 
        -- Architects
        -->

      <% if @property.additional_architects.count > 0 %>
        <%= ps_markup("Architects", @property.architect_qualified) %>
      <% else %>
        <%= ps_markup("Architect", @property.architect_qualified) %>
      <% end %>
      
      <% if @property.additional_architects.count > 0 %>
        <div class="ps-list-padded accordion-content__indent">
          <% @property.additional_architects.each do |a| %>
            <%= a.name + (a.year != nil ? " (" + a.year + ")" : "") %><br>
          <% end %>
        </div>      
      <% end %>
      
      <!-- 
        -- Builders
        -->

      <% if @property.additional_builders.count > 0 %>
        <%= ps_markup("Builders", @property.builder_qualified, false, true) %>
      <% else %>
        <%= ps_markup("Builder", @property.builder_qualified) %>
      <% end %>      
      
      <% if @property.additional_builders.count > 0 %>
        <div class="ps-list-padded accordion-content__indent">
          <% @property.additional_builders.each do |a| %>
            <%= a.name + (a.year != nil ? " (" + a.year + ")" : "") %><br>
          <% end %>
        </div>
      <% end %>

      <% if @property.building_permits.count > 0 %>
        <div class="ps-details-titles">
          Building Permits:
        </div>
        <div>
          <table class="ps-list-padded accordion-content__indent ps-tables">
            <tr>
              <th align="left">Permit</th><th>Year</th>
            </tr>
            <% @property.building_permits.each do |a| %>
              <tr>
                <td> <%= a.permit %> </td>
                <td> <%= (a.year != nil ? a.year : "N/A") %> </td>
              </tr>                  
            <% end %>
          </table>
        </div>
       <% else %>
        <div class='hanging-indent'> 
          <span class="ps-details-titles">Building Permits:</span> 
          None on File
        </div>
      <% end %>

    <% if @property.alterations.count > 0 then %>
      <div class="ps-details-titles">
          Alterations:
        </div>
        <div>
          <table class="ps-list-padded accordion-content__indent ps-tables">
            <tr>
              <th align="left">Cost</th><th>Description</th><th>Year</th>
            </tr>
            <% @property.alterations.each do |a| %>
              <tr>
                <td> <%= number_to_currency(a.cost, :precision => 0) %> </td>
                <td> <%= (a.description != nil ? a.description : "N/A") %> </td>
                <td> <%= (a.year != nil ? a.year : "N/A") %> </td>
              </tr>                  
            <% end %>
          </table>
        </div>
      <% else %>
        <div class='hanging-indent'> 
          <span class="ps-details-titles">Alterations:</span> 
          None on File
        </div>
      <% end %>

      <%= ps_markup("Original Owner", @property.originalowner) %>
      <%= ps_markup("Original Owner Spouse", 
                    @property.originalownerspouse) %>
      <%= ps_markup("Original Owner Occupation", 
                    @property.originalowneroccupation) %>

      <%= ps_markup("Place of Business", 
                    @property.placeofbusiness) %>

      <% if @property.other_owners.count > 0 %>
        <div class="ps-details-titles">
          Other Owners:
        </div>
        <div>
          <table class="ps-list-padded accordion-content__indent ps-tables">
            <tr>
              <th align="left">Name</th><th>Years</th>
            </tr>
            <% @property.other_owners.each do |a| %>
              <tr>
                <td> <%= a.name %> </td>
                <td> <%= (a.years != nil ? a.years : "N/A") %> </td>
              </tr>                  
            <% end %>
          </table>
        </div>
      <% else %>
        <div class='hanging-indent'> 
          <span class="ps-details-titles">Other Owners:</span> 
          None on File
        </div>
      <% end %>

      <%= ps_markup("Original Cost", 
        number_to_currency(@property.originalcost, :precision => 0)) %>

      <%= ps_markup("Original Lot Size", @property.originallotsize) %>

      <%= ps_markup("Moved on to Property", @property.movedontoproperty, true) %>

      <% if @property.former_addresses.count > 0 %>
        <div class="ps-details-titles">
          Former Addresses:
        </div>
        <div>
          <table class="ps-list-padded accordion-content__indent ps-tables">
            <tr>
              <th align="left">Address</th><th>Years</th>
            </tr>
            <% @property.former_addresses.each do |a| %>
              <tr>
                <td> <%= a.address1 + "  " + a.address2 %> </td>
                <td> <%= (a.years != nil ? a.years : "N/A") %> </td>
              </tr>                  
            <% end %>
          </table>
        </div>
      <% else %>
        <div class='hanging-indent'> 
          <span class="ps-details-titles">Former Addresses:</span> 
          None on File
        </div>
      <% end %>


      <div id="ps-note-sources">
    	  <%= if (@property.notes_shpo_and_sources != nil) then 
    		      markdown(@property.notes_shpo_and_sources)
    		    end 
    	  %>
      </div>

    </div> <!-- end ps-db-details -->

    <div id="mapid"></div>
    
    <div id="no-map-found">We're sorry, but we didn't find this address on a map.</div>
    
    <script>
      //var iDiv = document.createElement('div');
      //iDiv.id = 'mapid';
      //iDiv.style = "margin-left: auto; margin-right: auto; width: 600px; height: 400px;"
      //document.getElementsByTagName('body')[0].appendChild(iDiv);
      
      if (<%=@lat%> != 0 && <%=@lng%> != 0) {
        var mymap = L.map('mapid').setView([<%=@lat%>, <%=@lng%>], 17);
      
      	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
      		maxZoom: 18,
      		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
      			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
      			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
      		id: 'mapbox.streets'
      	}).addTo(mymap);
      	
      	var marker = L.marker([<%=@lat%>, <%=@lng%>]).addTo(mymap);
      } else {
        
        var element = document.getElementById("mapid");
        element.parentNode.removeChild(element);
        
        document.getElementById("no-map-found").setAttribute("style", "display:block");
      }
    </script>

    <br><br><br>
    
    <div id="ps-chrs-div">
      <div class="ps-chrs-title">
        California Historical Resource Status (CHRS) Codes Key
      </div>
      
      <table class="ps-chrs-key">
        <tr>
          <td align="left">Code</td><td>Description</td>
        </tr>
        <% Chrs.all.each do |c| %>
          <tr>
            <td valign="top"> <%= c.code %> </td>
            <td valign="top"> <%= c.description %> </td>
          </tr>                  
        <% end %>
      </table>
    </div> 

    <div id="prop-search-again-container">
    	<button id="ps-search-again-btn" 
    	  class="btn-arrow-anim  btn-arrow-anim--wide-square-bottom" type="button">
    		<span class=".btn-arrow-anim__text">Search Again </span>
    	</button>
    </div>
    

